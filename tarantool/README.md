# tarantool bonus HW

Чтобы запустить тарантул необходимо запустить скрипт `set_up.sh`, развернется докер контейнер с установленным тарантулом, затем в нём запускаем `start_cluster.sh`, что разворачивает кластер с 1 роутером и с 2 шардами стораджей, каждый из которых реплицирован, итого 5 инстансев, и подключает к роутеру, в котором можно взаимодействовать с тарантулом.

## Описание функций роутера:
- add_money (id, money, cost_per_second)
    
    добавляет `money` денег пользователю `id`. Если пользователь не создан, то прописывает ему `cost_per_second` скорость трат денег в секунду.

    - id - идентификатор пользователя
    - money - сколько у.е. добавить пользователю
    - cost_per_second - обязателен только для тех пользователей, у которых 0 на балансе, устанавливает скорость трат денег

- set_money_speed(user_id, cost)

    обновляет скорость трат денег пользователя `user_id`, устанавливая её на `cost`. Также обновляет баланс пользователя.

- get_balance(id)

    возвращает массив информации по пользователю `id`
    
    - user_id - идентификатор пользователя
    - money - сколько денег было у пользователя на момент последнего обновления
    - time - TimeStamp последнего обновления баланса
    - cost_per_second - скорость траты денег пользователя
    - tuple.money - (fiber.time() - tuple.time) * tuple.cost_per_second) - сколько денег у пользователя осталось на момент вызова функции

## Формат базы данных 
    
    format = {
            { name = 'user_id', type = 'unsigned' },
            { name = 'money', type = 'unsigned' },
            { name = 'time', type = 'unsigned' },
            { name = 'cost_per_second', type = 'unsigned'}
        }

## Expirationd

Проверяются все tuple, если деньги закончились (с учетом персональной скорости трат денег), то пользователь удаляется из базы данных, и отправляется GET запрос `https://postavte_otl.org/get/off/user_id`, где подставляется нужный user_id
